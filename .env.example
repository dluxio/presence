# DLUX Presence System Environment Configuration

# Primary Database (data.dlux.io) - for writes and main data source  
DB_PRIMARY_HOST=data.dlux.io
DB_PRIMARY_PORT=5432
DB_PRIMARY_NAME=postgres
DB_PRIMARY_USER=your_primary_db_user
DB_PRIMARY_PASSWORD=your_primary_db_password

# Local Replica Database - for reads and presence-specific data
DB_REPLICA_HOST=db_replica
DB_REPLICA_PORT=5432
DB_REPLICA_NAME=dlux_presence
DB_REPLICA_USER=replica_user
DB_REPLICA_PASSWORD=replica_password_2024

# Redis Configuration
REDIS_HOST=redis
REDIS_PORT=6379

# TURN Server Configuration for WebRTC
TURN_SECRET=your_turn_secret_key_here

# Application Settings
NODE_ENV=production
PORT=3000

# DLUX API
DLUX_API_URL=https://data.dlux.io

# Hive Blockchain Node
HIVE_NODE=https://api.hive.blog


# DLUX Presence System - Graceful Shutdown Improvements

## What was fixed:
✅ Proper interval cleanup in sync service
✅ Graceful shutdown with 10-second timeout  
✅ Better error handling during shutdown
✅ Prevention of multiple shutdown attempts
✅ Direct Node.js execution (not via npm)
✅ Proper Docker stop signals and timeouts

## How it works:
- SIGTERM/SIGINT signals trigger graceful shutdown
- All intervals are cleared first
- Database connections are properly closed
- Redis connections are properly closed  
- HTTP/Socket.IO servers are closed cleanly
- 10-second timeout forces exit if cleanup hangs
- 15-second Docker grace period

## Expected shutdown logs:
- 'SIGTERM received, shutting down gracefully...'
- 'Sync interval cleared'
- 'Primary database connection closed'
- 'Redis connection closed'
- 'Graceful shutdown completed'

## Testing:
docker-compose up --build
docker-compose down  # Should exit cleanly within 15 seconds

